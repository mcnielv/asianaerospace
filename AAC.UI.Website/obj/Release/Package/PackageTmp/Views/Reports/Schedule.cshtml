
@{
    ViewBag.Title = "Asian Aerospace Flight Scheduling & Monitoring System | Report | Schedule";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="panel-group" style="width:100%; float:none; margin-left:auto; margin-right: auto;">
    <div class="panel panel-primary">
        <div class="panel-heading" style="font-weight:bolder; font-size:12px;">Reports | Schedule</div>
        <div class="panel-body">
            <div class="container-fluid">
                <div class="row" style="margin-top:5px; margin-bottom:5px; padding-left:10px;">
                    <div class="col-sm-5" style="width:30%;">
                        <span class="txtbold">Start :</span><input type="text" id="txtStart" class="form-control" style="width:160px;" />
                    </div>
                    <div class="col-sm-pull-5">
                        <span class="txtbold"> End: </span> <input type="text" id="txtEnd" class="form-control" style="width:160px;" />
                    </div>
                </div>
                <div class="row" style="margin-top:5px; margin-bottom:5px; padding-left:25px;">
                    <button type="button" class="btn btn-default" style="background-color:Highlight; font-weight:bold;" id="btnGenerate">Generate</button>
                    <button type="button" class="btn btn-default" style="background-color:Highlight; font-weight:bold;" id="btnConvert">Print</button>
                    <button type="button" class="btn btn-default" style="background-color:Highlight; font-weight:bold;" id="btnCSV">CSV</button>
                </div>
            </div><br />
            <div class="container-fluid" style="margin: 0px 10px 0px 10px; padding-left:25px; font-size:13px;">
                <table style="width:100%;" id="tblReports">
                    @*<tr style="border:1px;border-style:solid;border-color:#000; font-size:13px;text-align:center;">                       
                        <td style="border:1px;border-style:solid;border-color:#000; width:10%;">Date</td>
                        <td style="border:1px;border-style:solid;border-color:#000;">Registry No.</td>
                        <td style="border:1px;border-style:solid;border-color:#000;">
                            <table style="width:100%;">
                                <tr><td style="border:1px;border-style:solid;border-color:#000;" colspan="2">MNL - CBU</td></tr>
                                <tr><td style="border:1px;border-style:solid;border-color:#000;">fasdfasdf</td><td style="border:1px;border-style:solid;border-color:#000;">Tidsafs - adfdsme</td></tr>
                            </table>
                        </td>
                        <td style="border:1px;border-style:solid;border-color:#000;">
                            <table style="width:100%;">
                                <tr><td style="border:1px;border-style:solid;border-color:#000;" colspan="2">BU</td></tr>
                                <tr><td style="border:1px;border-style:solid;border-color:#000;">fasdfasdf</td><td style="border:1px;border-style:solid;border-color:#000;">Tidsafs - adfdsme</td></tr>
                            </table>
                        </td>
                        <td style="border:1px;border-style:solid;border-color:#000;">
                            <table style="width:100%;">
                                <tr><td style="border:1px;border-style:solid;border-color:#000;" colspan="2">MNL - CBU</td></tr>
                                <tr><td style="border:1px;border-style:solid;border-color:#000;">fasdfasdf</td><td style="border:1px;border-style:solid;border-color:#000;">Tidsafs - adfdsme</td></tr>
                            </table>
                        </td>
                        <td style="border:1px;border-style:solid;border-color:#000;">Pilot</td>
                        <td style="border:1px;border-style:solid;border-color:#000;">Co-Pilot</td>
                        <td style="border:1px;border-style:solid;border-color:#000;">Crew</td>
                    </tr>*@
                </table>
                <table style="width:100%; border:2px;border-style:solid;border-color:#000; display:none;">
                    <tr style="border:1px;border-style:solid;border-color:#000; font-size:14px; font-weight:bolder; background-color:#3498fd;text-align:center;font-weight: bolder;">
                        <td style="border:1px;border-style:solid;border-color:#000; width:10%;">Date</td>
                        <td style="border:1px;border-style:solid;border-color:#000;">Registry No.</td>
                        <td style="border:1px;border-style:solid;border-color:#000;">Flight(1st leg)</td>
                        <td style="border:1px;border-style:solid;border-color:#000;">Waiting Time</td>
                        <td style="border:1px;border-style:solid;border-color:#000;">Flight(2nd leg)</td>
                        <td style="border:1px;border-style:solid;border-color:#000;">Pilot</td>
                        <td style="border:1px;border-style:solid;border-color:#000;">Co-Pilot</td>
                   </tr>
                    <tr style="border:1px;border-style:solid;border-color:#000; font-size:12px; text-align:center;">
                        <td style="border:1px;border-style:solid;border-color:#000; width:10%;">06/23/2016</td>
                        <td style="border:1px;border-style:solid;border-color:#000;">AC1-Reg-5020</td>
                        <td style="border:1px;border-style:solid;border-color:#000;">
                            <table style="width:100%;">
                                <tr>
                                    <td style="border:1px;border-style:solid;border-color:#000;" colspan="2">Manila-Cebu</td>
                                </tr>
                                <tr>
                                    <td style="border:1px;border-style:solid;border-color:#000;">06/23/2016</td>
                                    <td style="border:1px;border-style:solid;border-color:#000;">18:00 - 20:00</td>
                                </tr>
                           </table>
                        </td>
                        <td style="border:1px;border-style:solid;border-color:#000;">
                            <table style="width:100%;">
                                <tr>
                                    <td style="border:1px;border-style:solid;border-color:#000;" colspan="2">Cebu</td>
                                </tr>
                                <tr>
                                    <td style="border:1px;border-style:solid;border-color:#000;">06/23/2016</td>
                                    <td style="border:1px;border-style:solid;border-color:#000;">20:00 - 21:00</td>
                               </tr>
                           </table>
                        </td>
                        <td style="border:1px;border-style:solid;border-color:#000;">
                            <table style="width:100%;">
                                <tr>
                                    <td style="border:1px;border-style:solid;border-color:#000;" colspan="2">Cebu-Manila</td>
                                </tr>
                                <tr>
                                    <td style="border:1px;border-style:solid;border-color:#000;">06/23/2016</td>
                                    <td style="border:1px;border-style:solid;border-color:#000;">21:00 - 23:00</td>
                                </tr>
                           </table>
                        </td>
                        <td style="border:1px;border-style:solid;border-color:#000;">Tico, Lha Kim</td>
                        <td style="border:1px;border-style:solid;border-color:#000;">asdf, asdf</td>
                    </tr>
                    <tr>
                        <td colspan="8">
                            <table style="width:100%;border:1px;border-style:solid;border-color:#000;">
                                <tr style="text-align:center; font-weight:bolder; background-color:#acedf7;">
                                    <td style="border:1px;border-style:solid;border-color:#000;">Crew</td>
                                    <td style="border:1px;border-style:solid;border-color:#000;">Notes</td>
                                    <td style="border:1px;border-style:solid;border-color:#000;">Passengers</td>
                                    <td style="border:1px;border-style:solid;border-color:#000;">Flight Info</td>
                                    <td style="border:1px;border-style:solid;border-color:#000;">Techinical Stops</td>
                                    <td style="border:1px;border-style:solid;border-color:#000;">ETC</td>
                                </tr>
                                <tr>
                                    <td style="border:1px;border-style:solid;border-color:#000;">
                                        <strong>Crew(s)</strong>
                                        <table style="width:100%; text-align:center;">
                                            <tr><td>Diaz, Romy</td></tr>
                                            <tr><td>Vergel, Ace</td></tr>
                                        </table>
                                    </td>
                                    <td style="border:1px;border-style:solid;border-color:#000;">Notes</td>
                                    <td style="border:1px;border-style:solid;border-color:#000;">Passengers</td>
                                    <td style="border:1px;border-style:solid;border-color:#000;">Flight Info</td>
                                    <td style="border:1px;border-style:solid;border-color:#000;">Techinical Stops</td>
                                    <td style="border:1px;border-style:solid;border-color:#000;">ETC</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </div>

        </div>
    </div>
</div>



@Html.Action( "_DivLoading", "Common" )

@section scripts{
    @Scripts.Render( "~/bundles/jdtpicker" )
<script>
$(document).ready(function () {
    //$("#myModal").modal();
    var dateNow = new Date();
    $('#btnConvert').hide();
    $('#btnCSV').hide();
    
    function printPartOfPage(elementId) {
        var printContent = document.getElementById(elementId);
        var windowUrl = 'about:blank';
        var uniqueName = new Date();
  
        if (printContent.innerHTML.length <= 38) {
            $.alert({
                closeIcon: true,
                title: 'AAC Data Monitoring',
                content: 'Not available.'
            });
        } else {
            var windowName = 'Print' + uniqueName.getTime();
            var printWindow = window.open(windowUrl, windowName, 'left=50000,top=50000,width=0,height=0');
            printWindow.document.write('<img alt="" src="@Url.Content( "~/images/asianaerospace.png" )" style="width:970px;" height="60" />' + printContent.innerHTML);
            printWindow.document.close();
            printWindow.focus();
            printWindow.print();
            printWindow.close();
        }
    }
    //$.datetimepicker.setLocale('en');
    $('#txtStart').datepicker({
        //dateFormat: 'yyyy-MM-dd',
        dayOfWeekStart: 1,
        lang: 'en',
        disabledDates: ['1986/01/08', '1986/01/09', '1986/01/10'],
        startDate: dateNow//,'1986/01/05',
        //minDateTime: dateNow,
        //minDate: dateNow
    });
    $('#txtEnd').datepicker({
        //dateFormat: 'yyyy-MM-dd',
        dayOfWeekStart: 1,
        lang: 'en',
        disabledDates: ['1986/01/08', '1986/01/09', '1986/01/10'],
        startDate: dateNow//,'1986/01/05',
        //minDateTime: dateNow,
        //minDate: dateNow
    });
    $('#btnConvert').click(function () {
        printPartOfPage('tblReports');
        //var printContent = document.getElementById('tblReports');
        @*$.post('@Url.Action( "ConvertToPdf", "Reports" )', { 'html': printContent.innerHTML }, function (data) {
            alert('asa')
        }, 'json');*@
    });

    $('#btnCSV').click(function () {
        var msg = '';
        var start = $.trim($('#txtStart').val());
        var end = $.trim($('#txtEnd').val());

        if (start == '')
            msg += 'Start date is required. <br />';
        if (end == '')
            msg += 'End date is required. <br />';
        var dtstart = new Date(start);
        var dtEnd = new Date(end);
        if (dtEnd < dtstart)
            msg += 'Invalid date range. <br />';

        if (msg == '') {
            
            var model = {
                start: start,
                end: end
            }; $('#divLoading').show();
            $.post('@Url.Action( "CsvConvert", "Reports")', model, function (data) {
                if (data.Filename != '')
                {
                    window.open('@Url.Content( "~/pdffile/RptSchedule.csv" )');
                }
                //$.alert({
                //    closeIcon: true,
                //    title: 'AAC Data Monitoring',
                //    content: 'CSV File Generated'
                //});
                $('#divLoading').hide();

            }, 'json');
        }
        else {
            $.alert({
                closeIcon: true,
                title: 'AAC Data Monitoring',
                content: msg
            });
            $('#btnConvert').hide();
            $('#btnCSV').hide();
        }
    });

    $('#btnGenerate').click(function () {
        var msg = '';
        var start = $.trim($('#txtStart').val());
        var end = $.trim($('#txtEnd').val());

        if (start == '')
            msg += 'Start date is required. <br />';
        if (end == '')
            msg += 'End date is required. <br />';
        var dtstart = new Date(start);
        var dtEnd = new Date(end);
        if (dtEnd < dtstart)
            msg += 'Invalid date range. <br />';

        if (msg == '') {

            var trHeader = '';
            var trContent = '';
            var tbldata = '';
            trHeader += '<tr style="border:1px;border-style:solid;border-color:#000; font-size:14px; font-weight:bolder; background-color:#3498fd;text-align:center;font-weight: bolder;">';
            trHeader += '<td style="border:1px;border-style:solid;border-color:#000; width:10%;">Date</td>';
            trHeader += '<td style="border:1px;border-style:solid;border-color:#000;">Registry No.</td>';
            trHeader += '<td style="border:1px;border-style:solid;border-color:#000;">Flight(1st leg)</td>';
            trHeader += '<td style="border:1px;border-style:solid;border-color:#000;">Waiting Time</td>';
            trHeader += '<td style="border:1px;border-style:solid;border-color:#000;">Flight(2nd leg)</td>';
            trHeader += '<td style="border:1px;border-style:solid;border-color:#000;">Pilot</td>';
            trHeader += '<td style="border:1px;border-style:solid;border-color:#000;">Co-Pilot</td>';
            trHeader += '</tr>';
            
            var model = {
                start: start,
                end: end
            }; $('#divLoading').show();
            $.post('@Url.Action( "GetAllSchedules", "Reports")', model, function (data) {

                $('#tblReports')
                    .find('tr').remove()
                .find('td').remove();

                if (data != '') {
                    $('#btnConvert').show();
                    $('#btnCSV').show();
                    $.each(data, function (key, value) {
                        var startend = value.StartDate + ' - ' + value.EndDate;
                        if (value.StartDate == value.StartDate2)
                            startend = value.StartDate;

                        var startend2 = value.EndDate2 + ' - ' + value.EndDate;
                        if (value.EndDate2 == value.EndDate)
                            startend2 = value.EndDate2;

                        var waiting = value.StartDate2 + ' - ' + value.EndDate2;
                        if (value.StartDate2 == value.EndDate2)
                            waiting = value.StartDate2;

                        var startendTime = value.StartTime + ' - ' + value.StartTime2;
                        var waitingTime = value.StartTime2 + ' - ' + value.EndTime2;
                        var startendTime2 = value.EndTime2 + ' - ' + value.EndTime;

                        if (value.StartDate == value.StartDate2)
                            startend = value.StartDate;

                        tbldata +='<table style="width:100%; border:2px;border-style:solid;border-color:#000;">';
                        tbldata +='<tr style="border:1px;border-style:solid;border-color:#000; font-size:14px; font-weight:bolder; background-color:#3498fd;text-align:center;font-weight: bolder;">';
                        tbldata +='<td style="border:1px;border-style:solid;border-color:#000; width:10%;">Date</td>';
                        tbldata +='<td style="border:1px;border-style:solid;border-color:#000;">Registry No.</td>';
                        tbldata +='<td style="border:1px;border-style:solid;border-color:#000;">Flight(1st leg)</td>';
                        tbldata +='<td style="border:1px;border-style:solid;border-color:#000;">Waiting Time</td>';
                        tbldata +='<td style="border:1px;border-style:solid;border-color:#000;">Flight(2nd leg)</td>';
                        tbldata +='<td style="border:1px;border-style:solid;border-color:#000;">Pilot</td>';
                        tbldata +='<td style="border:1px;border-style:solid;border-color:#000;">Co-Pilot</td>';
                        tbldata +='</tr>';
                        tbldata +='<tr style="border:1px;border-style:solid;border-color:#000; font-size:12px; text-align:center;">';
                        tbldata += '<td style="border:1px;border-style:solid;border-color:#000; width:10%;">' + value.Date + '</td>';
                        tbldata += '<td style="border:1px;border-style:solid;border-color:#000;">' + value.AircraftRegistration + '</td>';
                        tbldata +='<td style="border:1px;border-style:solid;border-color:#000;">';
                        tbldata +='<table style="width:100%;">';
                        tbldata += '<tr><td style="border:1px;border-style:solid;border-color:#000;" colspan="2">' + value.FirstLegOfFlight + '</td></tr>';
                        tbldata += '<tr><td style="border:1px;border-style:solid;border-color:#000;">' + startend + '</td><td style="border:1px;border-style:solid;border-color:#000;">' + startendTime + '</td></tr>';
                        tbldata +='</table>';
                        tbldata +='</td>';
                        tbldata +='<td style="border:1px;border-style:solid;border-color:#000;">';
                        tbldata +='<table style="width:100%;">';
                        //tbldata += '<tr>';
                        var waitingLocation = value.FirstLegOfFlight.split('-');
                        tbldata +='<tr><td style="border:1px;border-style:solid;border-color:#000;" colspan="2">' + waitingLocation[1] + '</td></tr>';
                        //tbldata +='</tr>';
                        tbldata += '<tr><td style="border:1px;border-style:solid;border-color:#000;">' + waiting + '</td><td style="border:1px;border-style:solid;border-color:#000;">' + waitingTime + '</td></tr>';
                        tbldata +='</table>';
                        tbldata +='</td>';
                        tbldata +='<td style="border:1px;border-style:solid;border-color:#000;">';
                        tbldata +='<table style="width:100%;">';
                        tbldata += '<tr><td style="border:1px;border-style:solid;border-color:#000;" colspan="2">' + value.SecondLegOfFlight + '</td></tr>';
                        tbldata += '<tr><td style="border:1px;border-style:solid;border-color:#000;">' + startend2 + '</td><td style="border:1px;border-style:solid;border-color:#000;">' + startendTime2 + '</td></tr>';
                        tbldata +='</table>';
                        tbldata +='</td>';
                        tbldata += '<td style="border:1px;border-style:solid;border-color:#000;">' + value.Pilot + '</td>';
                        tbldata += '<td style="border:1px;border-style:solid;border-color:#000;">' + value.CoPilot + '</td>';
                        tbldata +='</tr>';
                        tbldata +='<tr>';
                        tbldata +='<td colspan="8">';
                        tbldata +='<table style="width:100%;border:1px;border-style:solid;border-color:#000;">';
                        tbldata +='<tr style="text-align:center; font-weight:bolder; background-color:#acedf7;">';
                        tbldata +='<td style="border:1px;border-style:solid;border-color:#000;">Crew(s)</td>';
                        tbldata +='<td style="border:1px;border-style:solid;border-color:#000;">Notes</td>';
                        tbldata +='<td style="border:1px;border-style:solid;border-color:#000;">Passenger(s)</td>';
                        tbldata +='<td style="border:1px;border-style:solid;border-color:#000;">Flight Info</td>';
                        tbldata +='<td style="border:1px;border-style:solid;border-color:#000;">Techinical Stops</td>';
                        tbldata +='<td style="border:1px;border-style:solid;border-color:#000;">ETC</td>';
                        tbldata +='</tr>';
                        tbldata +='<tr>';
                        tbldata +='<td style="border:1px;border-style:solid;border-color:#000;">';
                        //tbldata +='<strong>Crew(s)</strong>';
                        tbldata +='<table style="width:100%; text-align:center;">';
                        $.each(value.Crews, function (key, value) {
                            tbldata += '<tr>';
                            tbldata += '<td>' + value.Fullname + '</td>';
                            tbldata += '</tr>';
                        });
                        tbldata +='</table>';
                        tbldata +='</td>';
                        tbldata += '<td style="border:1px;border-style:solid;border-color:#000;">' + value.Notes + '</td>';
                        tbldata += '<td style="border:1px;border-style:solid;border-color:#000;">' + value.Passenger  + '</td>';
                        tbldata += '<td style="border:1px;border-style:solid;border-color:#000;">' + value.FlightInfo + '</td>';
                        tbldata += '<td style="border:1px;border-style:solid;border-color:#000;">' + value.TechStops + '</td>';
                        tbldata += '<td style="border:1px;border-style:solid;border-color:#000;">' + value.Etc + '</td>';
                        tbldata +='</tr>';
                        tbldata +='</table>';
                        tbldata +='</td>';
                        tbldata +='</tr>';
                        tbldata +='</table>';
                        
                    });

                    $('#tblReports').append(tbldata);
                }
                else {
                    trContent += '<tr style="border:1px;border-style:solid;border-color:#000; font-size:14px; font-weight:bolder; text-align:center;font-weight: bolder;">';
                    trContent += '<td colspan="8">Schedule is not available.</td>'
                    trContent += '</tr>';
                    $('#tblReports').append('<table>' + trHeader + trContent + '</table>');
                    $('#btnConvert').hide();
                    $('#btnCSV').hide();
                }
                $('#divLoading').hide();

            }, 'json');
        }
        else
        {
            $.alert({
                closeIcon: true,
                title: 'AAC Data Monitoring',
                content: msg
            });
            $('#btnConvert').hide();
            $('#btnCSV').hide();
        }
    });

});

    </script>
}


@section styles{
    @*@Styles.Render( "~/Content/fullcalendar" )*@
    <link href='@Url.Content("~/Content/jquery.datetimepicker.css")' rel='stylesheet' />
}